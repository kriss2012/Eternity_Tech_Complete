<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eternity Tech: The Padmanabha Enigma</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --color-primary: #6e44ff;
            --color-secondary: #ff44a7;
            --color-accent: #44ffd1;
            --color-dark: #0f1020;
            --color-darker: #080a14;
            --color-light: #f8f9ff;
            --color-surface: #1a1c30;
            --color-surface-light: #2a2d4a;
            --color-border: rgba(255, 255, 255, 0.1);
            --color-text: #ffffff;
            --color-text-secondary: #ccd0e0;
            --color-success: #44ff77;
            --color-warning: #ffcc44;
            --color-danger: #ff4466;
            --color-gold: #ffd700;
            --color-saffron: #ff9933;
            --color-temple: #8b4513;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Devanagari UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--color-darker) 0%, var(--color-dark) 100%);
            color: var(--color-text);
            overflow: hidden;
            min-height: 100vh;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--color-darker) 0%, var(--color-dark) 50%, var(--color-primary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 1s ease, visibility 1s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-content {
            text-align: center;
            padding: 40px;
        }

        .game-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(45deg, var(--color-accent), var(--color-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-subtitle {
            font-size: 1.5rem;
            margin-bottom: 32px;
            color: var(--color-text-secondary);
            font-weight: 300;
        }

        .sanskrit-text {
            font-size: 1.2rem;
            color: var(--color-gold);
            margin: 16px 0;
            font-style: italic;
        }

        .loading-bar {
            width: 300px;
            height: 6px;
            background: var(--color-surface);
            border-radius: 8px;
            margin: 24px auto;
            overflow: hidden;
        }

        .loading-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
            transition: width 0.3s ease;
        }

        /* Backstory Screen */
        .backstory-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--color-darker) 0%, var(--color-dark) 100%);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1900;
            padding: 40px;
        }

        .backstory-screen.active {
            display: flex;
        }

        .backstory-content {
            max-width: 800px;
            text-align: center;
            line-height: 1.6;
        }

        .backstory-title {
            font-size: 2rem;
            color: var(--color-accent);
            margin-bottom: 30px;
        }

        .backstory-text {
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s ease;
        }

        .backstory-text.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .backstory-skip {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: 1px solid var(--color-border);
            color: var(--color-text-secondary);
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .backstory-skip:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        /* Main Menu */
        .main-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--color-darker) 0%, var(--color-dark) 100%);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1800;
        }

        .main-menu.active {
            display: flex;
        }

        .menu-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-width: 250px;
        }

        .menu-button {
            padding: 16px 32px;
            background: var(--color-surface);
            color: var(--color-text);
            border: 2px solid var(--color-border);
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .menu-button:hover {
            background: var(--color-primary);
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        /* Game Interface */
        .game-interface {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            display: none;
        }

        .game-interface.active {
            display: block;
        }

        #game-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* HUD Elements */
        .game-hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 200;
        }

        .game-hud > * {
            pointer-events: auto;
        }

        .top-hud {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .chapter-info-hud {
            background: rgba(0, 0, 0, 0.8);
            padding: 12px 16px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .chapter-info-hud h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--color-accent);
        }

        .chapter-info-hud p {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
        }

        /* Dialogue System */
        .dialogue-box {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 700px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--color-primary);
            border-radius: 16px;
            padding: 24px;
            backdrop-filter: blur(15px);
            display: none;
        }

        .dialogue-box.active {
            display: block;
        }

        .character-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--color-accent);
            margin-bottom: 12px;
        }

        .dialogue-text {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 16px;
            min-height: 60px;
        }

        .dialogue-continue {
            text-align: right;
            font-size: 0.8rem;
            color: var(--color-text-secondary);
        }

        /* Puzzle Interface */
        .puzzle-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            max-width: 90vw;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--color-accent);
            border-radius: 16px;
            padding: 30px;
            backdrop-filter: blur(15px);
            display: none;
        }

        .puzzle-container.active {
            display: block;
        }

        .puzzle-title {
            font-size: 1.4rem;
            color: var(--color-accent);
            margin-bottom: 20px;
            text-align: center;
        }

        .puzzle-description {
            margin-bottom: 25px;
            line-height: 1.5;
            text-align: center;
        }

        .puzzle-grid {
            display: grid;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .puzzle-item {
            padding: 10px;
            background: var(--color-surface);
            border: 2px solid var(--color-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .puzzle-item:hover {
            border-color: var(--color-primary);
            background: var(--color-surface-light);
        }

        .puzzle-item.selected {
            border-color: var(--color-accent);
            background: var(--color-primary);
        }

        .puzzle-item.correct {
            border-color: var(--color-success);
            background: rgba(68, 255, 119, 0.2);
        }

        .puzzle-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .puzzle-button {
            padding: 10px 20px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .puzzle-button:hover {
            background: var(--color-secondary);
        }

        .puzzle-button:disabled {
            background: var(--color-surface);
            color: var(--color-text-secondary);
            cursor: not-allowed;
        }

        /* Inventory System */
        .inventory-panel {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            width: 300px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--color-border);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(15px);
            display: none;
        }

        .inventory-panel.active {
            display: block;
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 12px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .inventory-slot {
            aspect-ratio: 1;
            background: var(--color-surface);
            border: 2px solid var(--color-border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .inventory-slot:hover {
            border-color: var(--color-primary);
        }

        .inventory-slot.occupied {
            background: var(--color-surface-light);
            border-color: var(--color-accent);
        }

        /* Chapter Progress */
        .chapter-progress {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: var(--color-surface);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Controls Hint */
        .controls-hint {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 12px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            font-size: 0.8rem;
        }

        .controls-hint p {
            margin-bottom: 8px;
        }

        /* Sanskrit Text Styling */
        .sanskrit {
            font-family: 'Devanagari UI', 'Noto Sans Devanagari', serif;
            color: var(--color-gold);
            font-style: italic;
        }

        /* Cultural Elements */
        .cultural-element {
            border-left: 3px solid var(--color-saffron);
            padding-left: 15px;
            margin: 15px 0;
            font-style: italic;
        }

        /* Emotion-based dialogue styling */
        .emotion-excited {
            border-color: var(--color-warning);
        }

        .emotion-worried {
            border-color: var(--color-danger);
        }

        .emotion-confident {
            border-color: var(--color-success);
        }

        .emotion-determined {
            border-color: var(--color-primary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dialogue-box {
                width: 95%;
                padding: 16px;
            }

            .puzzle-container {
                width: 95%;
                padding: 20px;
            }

            .inventory-panel {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                right: auto;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <h1 class="game-title">Eternity Tech</h1>
            <h2 class="game-subtitle">The Padmanabha Enigma</h2>
            <div class="sanskrit-text">सत्यम् शिवम् सुन्दरम्</div>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p class="loading-text">Loading Ancient Wisdom...</p>
        </div>
    </div>

    <!-- Backstory Screen -->
    <div id="backstory-screen" class="backstory-screen">
        <button class="backstory-skip" onclick="skipBackstory()">Skip Backstory</button>
        <div class="backstory-content">
            <h2 class="backstory-title">The Beginning of the Journey</h2>
            <div id="backstory-text-container">
                <!-- Backstory text will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="main-menu" class="main-menu">
        <div class="menu-header">
            <h1 class="game-title">Eternity Tech</h1>
            <div class="sanskrit-text">सत्यम् शिवम् सुन्दरम्</div>
            <p>The Padmanabha Enigma</p>
        </div>
        <div class="menu-buttons">
            <button class="menu-button" onclick="startNewGame()">
                <i class="fas fa-play"></i> Start New Journey
            </button>
            <button class="menu-button" onclick="continueGame()">
                <i class="fas fa-save"></i> Continue Game
            </button>
            <button class="menu-button" onclick="showChapterSelect()">
                <i class="fas fa-list"></i> Chapter Selection
            </button>
            <button class="menu-button" onclick="showSettings()">
                <i class="fas fa-cog"></i> Settings
            </button>
            <button class="menu-button" onclick="showCredits()">
                <i class="fas fa-info-circle"></i> About
            </button>
        </div>
    </div>

    <!-- Game Interface -->
    <div id="game-interface" class="game-interface">
        <div id="game-container"></div>
        
        <!-- Game HUD -->
        <div class="game-hud">
            <!-- Top HUD -->
            <div class="top-hud">
                <div class="chapter-info-hud">
                    <h3 id="chapter-title">Chapter 1: Code of the Ancients</h3>
                    <p id="chapter-location">Mumbai, Eternity Tech HQ</p>
                </div>
                <div class="game-stats">
                    <div class="stat-item">
                        <i class="fas fa-heart"></i>
                        <span id="health">100</span>
                    </div>
                </div>
            </div>

            <!-- Chapter Progress -->
            <div class="chapter-progress">
                <div>Chapter <span id="current-chapter">1</span> of 12</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div id="progress-text">Starting the adventure...</div>
            </div>

            <!-- Controls Hint -->
            <div class="controls-hint">
                <p><strong>Movement:</strong> WASD keys</p>
                <p><strong>Interact:</strong> E key / Click</p>
                <p><strong>Continue:</strong> SPACE key</p>
                <p><strong>Menu:</strong> ESC key</p>
            </div>
        </div>

        <!-- Dialogue Box -->
        <div id="dialogue-box" class="dialogue-box">
            <div class="character-name" id="character-name">Krishna</div>
            <div class="dialogue-text" id="dialogue-text">Welcome to Eternity Tech!</div>
            <div class="dialogue-continue">
                <p>Press SPACE or click to continue</p>
            </div>
        </div>

        <!-- Puzzle Container -->
        <div id="puzzle-container" class="puzzle-container">
            <div class="puzzle-title" id="puzzle-title">Ancient Sanskrit Cipher</div>
            <div class="puzzle-description" id="puzzle-description">
                Arrange the Sanskrit symbols in the correct order to decode the message.
            </div>
            <div class="puzzle-grid" id="puzzle-grid">
                <!-- Puzzle elements will be generated dynamically -->
            </div>
            <div class="puzzle-actions">
                <button class="puzzle-button" onclick="checkPuzzle()">Check Solution</button>
                <button class="puzzle-button" onclick="resetPuzzle()">Reset</button>
                <button class="puzzle-button" onclick="closePuzzle()">Close</button>
            </div>
        </div>

        <!-- Inventory Panel -->
        <div id="inventory-panel" class="inventory-panel">
            <div class="inventory-header">
                <h4><i class="fas fa-backpack"></i> Inventory</h4>
                <button onclick="closeInventory()">&times;</button>
            </div>
            <div class="inventory-grid" id="inventory-grid">
                <!-- Inventory slots will be generated -->
            </div>
        </div>
    </div>

<script>
// Eternity Tech: The Padmanabha Enigma - Complete Game Engine
class EternityTechGame {
    constructor() {
        this.scene = null;
        this.camera = null;
        this.renderer = null;
        this.gameState = 'loading';
        this.currentChapter = 1;
        this.currentScene = 1;
        this.currentDialogue = 0;
        this.playerData = {
            progress: JSON.parse(localStorage.getItem('eternitytech_progress')) || {},
            inventory: JSON.parse(localStorage.getItem('eternitytech_inventory')) || [],
            settings: JSON.parse(localStorage.getItem('eternitytech_settings')) || this.getDefaultSettings(),
            stats: { health: 100, score: 0 }
        };
        
        // Game systems
        this.inventorySystem = new InventorySystem();
        this.puzzleSystem = new PuzzleSystem();
        this.chapterData = this.initChapterData();
        this.currentDialogues = [];
        
        this.init();
    }

    getDefaultSettings() {
        return {
            masterVolume: 70,
            musicVolume: 50,
            sfxVolume: 70,
            graphicsQuality: 'medium'
        };
    }

    init() {
        this.showLoadingScreen();
        this.setupEventListeners();
        
        // Simulate loading
        setTimeout(() => {
            this.showBackstory();
        }, 3000);
    }

    showLoadingScreen() {
        const loadingScreen = document.getElementById('loading-screen');
        const progressBar = document.querySelector('.loading-progress');
        let progress = 0;
        
        const loadingInterval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress >= 100) {
                progress = 100;
                clearInterval(loadingInterval);
            }
            progressBar.style.width = progress + '%';
        }, 200);
    }

    showBackstory() {
        document.getElementById('loading-screen').classList.add('hidden');
        document.getElementById('backstory-screen').classList.add('active');
        
        const backstoryTexts = [
            "In the heart of Mumbai, two siblings are about to change the world...",
            "Krishna and Sakshi Patil have spent years developing revolutionary technology.",
            "Their innovation: combining ancient Sanskrit wisdom with quantum computing.",
            "What started as academic research has become something extraordinary.",
            "Sanskrit's perfect grammar makes it ideal for quantum algorithms.",
            "Their mentor, Parth Deshmukh, guided them from the beginning.",
            "Today is the day they present their creation to the world.",
            "But unknown forces are watching... and waiting.",
            "Ancient knowledge holds power that some would kill for.",
            "The journey begins with a presentation that will change everything.",
            "Welcome to the world of Eternity Tech.",
            "सत्यम् शिवम् सुन्दरम् - Truth, Auspiciousness, Beauty."
        ];
        
        let textIndex = 0;
        const container = document.getElementById('backstory-text-container');
        
        const showNextText = () => {
            if (textIndex < backstoryTexts.length) {
                const textElement = document.createElement('div');
                textElement.className = 'backstory-text';
                textElement.textContent = backstoryTexts[textIndex];
                container.appendChild(textElement);
                
                // Animate in
                setTimeout(() => {
                    textElement.classList.add('visible');
                }, 100);
                
                textIndex++;
                setTimeout(showNextText, 2500);
            } else {
                // Backstory complete, show menu after delay
                setTimeout(() => {
                    this.showMainMenu();
                }, 3000);
            }
        };
        
        showNextText();
    }

    showMainMenu() {
        document.getElementById('backstory-screen').classList.remove('active');
        document.getElementById('main-menu').classList.add('active');
        this.gameState = 'menu';
    }

    setupEventListeners() {
        document.addEventListener('keydown', (e) => {
            this.handleKeyPress(e);
        });

        document.addEventListener('click', (e) => {
            if (e.target.closest('#dialogue-box') && !e.target.closest('.dialogue-continue')) {
                this.nextDialogue();
            }
        });

        // Prevent context menu for immersion
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });
    }

    handleKeyPress(e) {
        switch (e.code) {
            case 'Space':
                e.preventDefault();
                if (this.gameState === 'dialogue') {
                    this.nextDialogue();
                }
                break;
            case 'Escape':
                if (this.gameState === 'playing') {
                    this.showPauseMenu();
                }
                break;
            case 'KeyE':
                if (this.gameState === 'playing') {
                    this.interact();
                }
                break;
            case 'KeyI':
                if (this.gameState === 'playing') {
                    this.toggleInventory();
                }
                break;
        }
    }

    startNewGame() {
        this.playerData.progress = {};
        this.playerData.inventory = [];
        this.currentChapter = 1;
        this.currentScene = 1;
        this.savePlayerData();
        this.startChapter(1);
    }

    continueGame() {
        const lastChapter = Math.max(1, ...Object.keys(this.playerData.progress).map(Number)) || 1;
        this.startChapter(lastChapter);
    }

    startChapter(chapterNumber) {
        this.currentChapter = chapterNumber;
        this.currentScene = 1;
        
        document.getElementById('main-menu').classList.remove('active');
        document.getElementById('game-interface').classList.add('active');
        
        const chapterData = this.chapterData[chapterNumber];
        document.getElementById('chapter-title').textContent = `Chapter ${chapterNumber}: ${chapterData.title}`;
        document.getElementById('chapter-location').textContent = chapterData.location;
        document.getElementById('current-chapter').textContent = chapterNumber;
        
        this.updateProgress();
        this.initThreeJS();
        this.startChapterScene(chapterNumber, 1);
    }

    initChapterData() {
        return {
            1: {
                title: "Code of the Ancients",
                location: "Mumbai, Eternity Tech HQ",
                scenes: {
                    1: {
                        title: "Eternity Tech Lobby - Morning",
                        dialogues: [
                            { character: "Employee 1", text: "Sir, Reuters wants an interview! They're calling it the 'Sanskrit Revolution'!", emotion: "excited" },
                            { character: "Krishna", text: "Revolution? Arrey yaar, we're just bringing our grandparents' wisdom to quantum processors.", emotion: "grinning" },
                            { character: "Sakshi", text: "Bhai, your ego is also getting quantum-sized.", emotion: "rolling_eyes" },
                            { character: "Parth Deshmukh", text: "Beta Krishna, beta Sakshi, ready for the biggest day of your lives?", emotion: "warm" },
                            { character: "Krishna", text: "Parth ji, you taught us everything. Today, we make our ancestors proud.", emotion: "respectful" },
                            { character: "Sakshi", text: "Aashirwad dijiye, Parth uncle. Without you, we're just two kids with big dreams.", emotion: "touching_feet" },
                            { character: "Parth", text: "Vijayee bhava, both of you. आज तुम्हारा दिन है।", emotion: "blessing" }
                        ],
                        puzzle: null,
                        action: () => this.startChapterScene(1, 2)
                    },
                    2: {
                        title: "Presentation Hall - Tech Demo",
                        dialogues: [
                            { character: "Krishna", text: "Namaskar! Today, we prove that our शास्त्र (shastras) aren't just philosophy—they're the future of technology!", emotion: "confident" },
                            { character: "Investor Jenkins", text: "Mr. Patil, Sanskrit is beautiful, but can ancient language really optimize quantum computing?", emotion: "skeptical" },
                            { character: "Sakshi", text: "Sir, Sanskrit has zero ambiguity—no grammar confusion, perfect for algorithms. If Panini could create 4,000 rules without a computer, imagine what we can do WITH one.", emotion: "confident" },
                            { character: "Krishna", text: "Ladies and gentlemen, witness Project Vedic OS—solving protein folding in real time!", emotion: "theatrical" },
                            { character: "Dr. Sharma", text: "Impossible! This is 400% faster than our best supercomputers!", emotion: "amazed" },
                            { character: "Sakshi", text: "Show-off. But good show-off.", emotion: "whispering" },
                            { character: "Krishna", text: "$10 million valuation, choti. We did it!", emotion: "winking" }
                        ],
                        puzzle: {
                            type: "sanskrit_sequence",
                            title: "Demonstrate Vedic OS",
                            description: "Arrange the Sanskrit code sequence to optimize the quantum algorithm",
                            items: ["ॐ", "गणेशाय", "नमः", "सरस्वत्यै", "विद्या", "दान"]
                        },
                        action: () => this.startChapterScene(1, 3)
                    },
                    3: {
                        title: "Rooftop Celebration - Sunset",
                        dialogues: [
                            { character: "Sakshi", text: "Bhai, remember when you taught me first Sanskrit shloka? 'सरस्वती नमस्तुभ्यं'—pray to Goddess of Knowledge.", emotion: "nostalgic" },
                            { character: "Krishna", text: "You were seven, correcting my pronunciation. Typical Sakshi.", emotion: "smiling" },
                            { character: "Sakshi", text: "Are we doing the right thing? All this power... what if wrong people get it?", emotion: "worried" },
                            { character: "Krishna", text: "Then we make sure they don't. विद्या दान ही सच्चा दान है (Knowledge sharing is true charity). That's our dharma.", emotion: "serious" }
                        ],
                        puzzle: null,
                        action: () => this.startChapterScene(1, 4)
                    },
                    4: {
                        title: "Late Night Crisis - Office",
                        dialogues: [
                            { character: "Parth", text: "Krishna! Sakshi! Someone's been stealing our research! This drive... it has a map, Sanskrit coordinates—", emotion: "panicked" },
                            { character: "Krishna", text: "Slow down, Parth ji. Who would want our code?", emotion: "concerned" },
                            { character: "Parth", text: "The temple... Padmanabhaswamy... Opens every 400 years... Vedic Sutra—", emotion: "trembling" },
                            { character: "Gunman Leader", text: "Hand over the drive, old man!", emotion: "threatening" },
                            { character: "Parth", text: "Never! This knowledge belongs to humanity!", emotion: "defiant" },
                            { character: "Parth", text: "Temple... Vault B... Viren... don't let evil win...", emotion: "dying" },
                            { character: "Sakshi", text: "Parth uncle! No!", emotion: "crying" },
                            { character: "Krishna", text: "We'll finish what you started. Promise.", emotion: "grief_stricken" }
                        ],
                        puzzle: null,
                        action: () => this.startChapterScene(1, 5)
                    },
                    5: {
                        title: "Escape Through Mumbai",
                        dialogues: [
                            { character: "Krishna", text: "Can you hack their comms?", emotion: "urgent" },
                            { character: "Sakshi", text: "भगवान का नाम लेकर (Taking God's name)... Done! Their radios are fried!", emotion: "focused" },
                            { character: "Krishna", text: "Vighnaharta, show us the path.", emotion: "praying" },
                            { character: "Goons", text: "Hanuman! भूत! Run!", emotion: "terrified" },
                            { character: "Sakshi", text: "Bhai... did you see...?", emotion: "awestruck" },
                            { character: "Krishna", text: "Hanuman ji saved us. जय हनुमान। We're protected.", emotion: "reverent" }
                        ],
                        puzzle: {
                            type: "escape_route",
                            title: "Escape Through Mumbai",
                            description: "Find the safe path through the temple to avoid the gunmen",
                            items: ["Left", "Right", "Straight", "Temple", "Back Door", "Prayer Hall"]
                        },
                        action: () => this.completeChapter(1)
                    }
                }
            },
            2: {
                title: "The Sanskrit Cipher",
                location: "Mumbai Streets and Labs",
                scenes: {
                    1: {
                        title: "Parth's Funeral - Next Day",
                        dialogues: [
                            { character: "Sakshi", text: "He was like a father to us.", emotion: "sobbing" },
                            { character: "Krishna", text: "His sacrifice won't be wasted. The cipher he saved... it's our responsibility now.", emotion: "voice_breaking" },
                            { character: "Pandit ji", text: "बेटा, जो गया वो वापस नहीं आएगा। But his good deeds will guide you.", emotion: "wise" }
                        ],
                        puzzle: null,
                        action: () => this.startChapterScene(2, 2)
                    },
                    2: {
                        title: "Decoding Session - Krishna's Apartment",
                        dialogues: [
                            { character: "Sakshi", text: "This cipher... it's not just code. It's Vedic astronomy mixed with quantum encryption.", emotion: "frustrated" },
                            { character: "Krishna", text: "Tell me about our childhood again. When did you first realize you were smarter than me?", emotion: "nostalgic" },
                            { character: "Sakshi", text: "When I was five, you couldn't solve 2+2. I did it in Sanskrit: द्वे + द्वे = चत्वारि।", emotion: "smiling_through_tears" },
                            { character: "Krishna", text: "And now you're solving mysteries our ancestors left behind.", emotion: "proud" },
                            { character: "Sakshi", text: "Bhai, look at this! Coordinates... Kerala... Padmanabhaswamy Temple!", emotion: "excited" },
                            { character: "Krishna", text: "Vault B opens in 28 days. During Kartik Purnima, when moon aligns with Vishnu constellation.", emotion: "amazed" }
                        ],
                        puzzle: {
                            type: "cipher_decode",
                            title: "Decrypt Parth's Cipher",
                            description: "Use Sanskrit astronomy knowledge to decode the hidden coordinates",
                            items: ["चन्द्र", "सूर्य", "मंगल", "बुध", "गुरु", "शुक्र", "शनि", "राहु", "केतु"]
                        },
                        action: () => this.startChapterScene(2, 3)
                    },
                    3: {
                        title: "Childhood Flashback - Pune",
                        dialogues: [
                            { character: "Younger Sakshi", text: "Bhai, why are you learning programming in English? Why not Sanskrit?", emotion: "curious" },
                            { character: "Younger Krishna", text: "Pagal hai kya? Computers don't understand Sanskrit!", emotion: "dismissive" },
                            { character: "Younger Sakshi", text: "Then we'll teach them. Sanskrit is perfect—no ambiguity, pure logic.", emotion: "determined" },
                            { character: "Their Father", text: "My children will change the world someday.", emotion: "proud" }
                        ],
                        puzzle: null,
                        action: () => this.startChapterScene(2, 4)
                    },
                    4: {
                        title: "The Revelation",
                        dialogues: [
                            { character: "Sakshi", text: "Bhai! The cipher isn't just coordinates—it's a medical formula! Molecular healing patterns!", emotion: "excited" },
                            { character: "Krishna", text: "'Sarva roga nivaran sutra'—cure for all diseases. This is what Viren wants.", emotion: "reading" },
                            { character: "Sakshi", text: "If this falls into wrong hands...", emotion: "worried" },
                            { character: "Krishna", text: "It won't. We go to Kerala. We find the truth.", emotion: "determined" },
                            { character: "Viren Arora", text: "Mr. Patil, you have something that belongs to me.", emotion: "menacing" },
                            { character: "Krishna", text: "Knowledge belongs to everyone, not to profiteers.", emotion: "defiant" },
                            { character: "Viren", text: "How noble. How naive. Check your news.", emotion: "cold" },
                            { character: "Sakshi", text: "He's framing us!", emotion: "shocked" },
                            { character: "Viren", text: "24 hours to surrender the cipher. Or your company burns.", emotion: "threatening" }
                        ],
                        puzzle: {
                            type: "medical_formula",
                            title: "Decode Medical Formula",
                            description: "Arrange the Sanskrit medical terms to reveal the healing formula",
                            items: ["सर्व", "रोग", "निवारण", "सूत्र", "आयुर्वेद", "चिकित्सा"]
                        },
                        action: () => this.completeChapter(2)
                    }
                }
            },
            3: {
    title: "The Arora Gambit",
    location: "Mumbai - Chase Sequence",
    scenes: {
      1: {
        title: "Under Siege - Eternity Tech Office",
        dialogues: [
          { character: "Sakshi", text: "Our life's work... destroyed by lies.", emotion: "frustrated" },
          { character: "Krishna", text: "Truth will emerge. But first, we survive.", emotion: "determined" },
          { character: "Ramesh", text: "Sir, back exit is clear. But police coming soon.", emotion: "loyal" },
          { character: "Krishna", text: "Ramesh bhai, thank you. Take care of our employees.", emotion: "grateful" }
        ],
        puzzle: {
          type: "stealth_escape",
          title: "Escape Plan",
          description: "Choose the correct exit route to avoid police detection",
          items: ["Back Exit", "Front Door", "Rooftop", "Basement"]
        },
        action: () => startChapterScene(3, 2)
      },
      2: {
        title: "Chase Through Dharavi",
        dialogues: [
          { character: "Viren's Agent", text: "Target spotted! Sector 7!", emotion: "radio" },
          { character: "Krishna", text: "Remember our college parkour training?", emotion: "urgent" },
          { character: "Sakshi", text: "I was always faster than you!", emotion: "grinning" },
          { character: "Local Kid", text: "Uncle, this way! Police nahi jayenge!", emotion: "helpful" },
          { character: "Krishna", text: "धन्यवाद, बेटा!", emotion: "grateful" }
        ],
        puzzle: {
          type: "parkour_path",
          title: "Navigate the Slums",
          description: "Select correct path to evade pursuers",
          items: ["Rooftops", "Alleyways", "Streets", "Sewers"]
        },
        action: () => startChapterScene(3, 3)
      },
      3: {
        title: "Hideout in Ancient Temple",
        dialogues: [
          { character: "Sakshi", text: "Bhai, I'm scared. What if our technology really does get misused?", emotion: "worried" },
          { character: "Krishna", text: "Every discovery can be weapon or blessing. Depends on who holds it.", emotion: "serious" },
          { character: "Sakshi", text: "Then we make sure right people hold it.", emotion: "determined" },
          { character: "Krishna", text: "Promise. Knowledge belongs to humanity, not to those who would cage it for profit.", emotion: "solemn" }
        ],
        puzzle: {
          type: "moral_choice",
          title: "Trust Decision",
          description: "Choose whom to trust with your technology",
          items: ["Scientists", "Government", "Public", "Private Firms"]
        },
        action: () => startChapterScene(3, 4)
      },
      4: {
        title: "Laxman's Video Call",
        dialogues: [
          { character: "Laxman", text: "Yaar Krishna! News mein dekha. Are you both okay?", emotion: "concerned" },
          { character: "Krishna", text: "Alive, but barely. Laxman, we need to go to Kerala.", emotion: "serious" },
          { character: "Laxman", text: "Kerala? For vacation? At this time?", emotion: "surprised" },
          { character: "Sakshi", text: "It's complicated, Laxman bhaiya.", emotion: "smiling" },
          { character: "Laxman", text: "Whatever it is, I'm with you. Sole Mate has transport network all over South India. Use it.", emotion: "supportive" },
          { character: "Laxman", text: "Emergency alert system. If you're in trouble, press button twice. I'll come running.", emotion: "serious" },
          { character: "Krishna", text: "True friend. सच्चा मित्र।", emotion: "emotional" }
        ],
        puzzle: {
          type: "emergency_alert",
          title: "Set Alert",
          description: "Protocol for emergency response activation",
          items: ["Press once", "Press twice", "Hold button", "Ignore"]
        },
        action: () => startChapterScene(3, 5)
      },
      5: {
        title: "Departure Decision",
        dialogues: [
          { character: "Sakshi", text: "Once we board this train, there's no going back.", emotion: "nervous" },
          { character: "Krishna", text: "Parth ji died for this truth. We finish his mission.", emotion: "determined" },
          { character: "Station Announcement", text: "Kerala Express departing Platform 3!", emotion: "announcement" },
          { character: "Krishna", text: "हे भगवान, guide us on this path. Protect us, protect the knowledge, protect humanity.", emotion: "praying" }
        ],
        puzzle: {
          type: "timing_decision",
          title: "Board the Train",
          description: "Choose the right moment to board safely",
          items: ["Immediately", "Wait for 5 min", "Wait for police to leave", "Change platform"]
        },
        action: () => startChapterScene(4, 1)
      }
    }
},

        4: {
            title: "Backwater Mysteries",
            location: "Kerala Journey",
            scenes: {
                1: {
                    title: "Train Journey - Dawn",
                    dialogues: [
                        { character: "Sakshi", text: "Padmanabhaswamy Temple... 1750, Maharaja Marthanda Varma dedicated entire kingdom to Lord Vishnu.", emotion: "reading" },
                        { character: "Krishna", text: "And Vault B... unopened for centuries. What were they protecting?", emotion: "curious" },
                        { character: "Fellow Passenger", text: "You're going to Anantha Padmanabha Swamy? पवित्र स्थान है (Sacred place).", emotion: "friendly" },
                        { character: "Krishna", text: "Uncle, you know the temple?", emotion: "inquiring" },
                        { character: "Old Man", text: "My grandfather was priest there. He used to say, 'कुछ रहस्य खुलने के लिए नहीं हैं' (Some mysteries aren't meant to be opened).", emotion: "mysterious" },
                        { character: "Sakshi", text: "Why?", emotion: "curious" },
                        { character: "Old Man", text: "Because when gods hide something, they have good reason.", emotion: "serious" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(4, 2)
                },
                2: {
                    title: "Backwaters - Stunning Visuals",
                    dialogues: [
                        { character: "Krishna", text: "Look at this beauty, Sakshi. Our ancestors chose perfect places for temples.", emotion: "amazed" },
                        { character: "Sakshi", text: "Every location has cosmic significance. Temple isn't just building—it's spiritual technology.", emotion: "explaining" },
                        { character: "Boatman Raman", text: "Saab, temple has many stories. Some true, some... difficult to believe.", emotion: "accented" },
                        { character: "Krishna", text: "Like what?", emotion: "curious" },
                        { character: "Raman", text: "They say Vault B has divine protection. Those who tried to open it... वे वापस नहीं आए (They never returned).", emotion: "ominous" },
                        { character: "Viren", text: "Enjoying the scenic route, Mr. Patil? I have people everywhere.", emotion: "menacing" },
                        { character: "Krishna", text: "We're not afraid of you.", emotion: "defiant" },
                        { character: "Viren", text: "You should be. Check your social media.", emotion: "threatening" },
                        { character: "Sakshi", text: "Our reputation... destroyed.", emotion: "distressed" },
                        { character: "Krishna", text: "Reputation can be rebuilt. Truth is eternal.", emotion: "determined" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(4, 3)
                },
                3: {
                    title: "Meeting Dr. Meenakshi Iyer",
                    dialogues: [
                        { character: "Dr. Meenakshi Iyer", text: "Krishna beta, Sakshi beta, I knew your arrival was destined.", emotion: "warm" },
                        { character: "Sakshi", text: "Namaskar, Doctor aunty. How did you know?", emotion: "respectful" },
                        { character: "Dr. Iyer", text: "Dreams. For three nights, I saw two young scholars coming to protect sacred knowledge.", emotion: "mysterious" },
                        { character: "Krishna", text: "We need to understand Vault B. What's really inside?", emotion: "inquiring" },
                        { character: "Dr. Iyer", text: "Not treasure, beta. Knowledge that could heal world... or destroy it. Ancient medical treatise—molecular level healing.", emotion: "serious" },
                        { character: "Sakshi", text: "Our ancestors knew molecular medicine?", emotion: "amazed" },
                        { character: "Dr. Iyer", text: "They knew everything. But they also knew human nature. That's why protections exist.", emotion: "serious" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(4, 4)
                },
                4: {
                    title: "The Supernatural Warning",
                    dialogues: [
                        { character: "Dr. Iyer", text: "Temple has guardians—not just human. Divine protectors.", emotion: "serious" },
                        { character: "Krishna", text: "Like what?", emotion: "skeptical" },
                        { character: "Dr. Iyer", text: "Nagas (serpents), Devas... and Hanuman ji himself watches over it.", emotion: "serious" },
                        { character: "Sakshi", text: "Just like in Mumbai temple...", emotion: "whispering" },
                        { character: "Dr. Iyer", text: "You've seen him, haven't you? Hanuman ji?", emotion: "knowing" },
                        { character: "Krishna", text: "How did you know?", emotion: "amazed" },
                        { character: "Dr. Iyer", text: "Because you're still alive. He's protecting you for this mission.", emotion: "serious" },
                        { character: "Dr. Iyer", text: "Storm coming. Like the one brewing in your destiny.", emotion: "ominous" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(5, 1)
                }
            }
        },

        5: {
            title: "The City of Temples",
            location: "Thiruvananthapuram Exploration",
            scenes: {
                1: {
                    title: "City Streets - Morning",
                    dialogues: [
                        { character: "Sakshi", text: "Three artifacts we need—Shankh, Yantra, and Palm manuscript. Scattered across city.", emotion: "focused" },
                        { character: "Krishna", text: "Like a treasure hunt designed by our ancestors.", emotion: "intrigued" },
                        { character: "Auto Driver Krishnan", text: "Where to, saab? You look like scholars!", emotion: "friendly" },
                        { character: "Krishna", text: "Government Oriental Manuscript Library.", emotion: "determined" },
                        { character: "Krishnan", text: "Ah! You study ancient knowledge! बहुत अच्छा (Very good)! Our culture needs young people like you.", emotion: "proud" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(5, 2)
                },
                2: {
                    title: "Manuscript Library - Puzzle Sequence",
                    dialogues: [
                        { character: "Librarian", text: "Why do you need Chakra Yantra manuscript specifically?", emotion: "suspicious" },
                        { character: "Sakshi", text: "Research on astronomical alignments in temple architecture.", emotion: "confident" },
                        { character: "Krishna", text: "गणेशाय नमः... starts with Ganesha prayer, then follows Vedic sequence...", emotion: "solving" },
                        { character: "Sakshi", text: "Got it! The manuscript!", emotion: "excited" }
                    ],
                    puzzle: {
                        type: "sanskrit_sequence",
                        title: "Arrange Vedic Verses",
                        description: "Arrange the Sanskrit verses in correct order to access hidden compartment",
                        items: ["गणेशाय नमः", "सरस्वत्यै नमः", "विद्यायै नमः", "दानायै नमः"]
                    },
                    action: () => this.startChapterScene(5, 3)
                },
                3: {
                    title: "Spice Market Chase",
                    dialogues: [
                        { character: "Sakshi", text: "According to manuscript, Shankh is hidden in 'fragrance temple'.", emotion: "alert" },
                        { character: "Spice Merchant", text: "Looking for something special, beta?", emotion: "helpful" },
                        { character: "Krishna", text: "Ancient conch shell, family heirloom.", emotion: "explaining" },
                        { character: "Agent 1", text: "There! Target acquired!", emotion: "alert" },
                        { character: "Sakshi", text: "My size has advantages!", emotion: "sliding" },
                        { character: "Krishna", text: "So does mine!", emotion: "swinging" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(5, 4)
                },
                4: {
                    title: "Planetarium - Sakshi's Moment",
                    dialogues: [
                        { character: "Sakshi", text: "Bhai, this is where I shine. Vedic astronomy is my specialty.", emotion: "confident" },
                        { character: "Planetarium Director", text: "Young lady, can you really calculate planetary positions without computer?", emotion: "skeptical" },
                        { character: "Sakshi", text: "Watch me. कार्तिक पूर्णिमा में, चन्द्र और विष्णु नक्षत्र का संयोग...", emotion: "demonstrating" },
                        { character: "Krishna", text: "My sister, the genius.", emotion: "proud" },
                        { character: "Sakshi", text: "You taught me to dream big.", emotion: "blushing" }
                    ],
                    puzzle: {
                        type: "astronomy_puzzle",
                        title: "Calculate Planetary Alignment",
                        description: "Determine the correct planetary alignment on Kartik Purnima to reveal Yantra location"
                    },
                    action: () => this.startChapterScene(5, 5)
                },
                5: {
                    title: "Surveillance Discovery",
                    dialogues: [
                        { character: "Krishna", text: "We're not just finding artifacts. We're being herded.", emotion: "serious" },
                        { character: "Sakshi", text: "Viren wants us to find everything, then take it from us.", emotion: "worried" },
                        { character: "News Anchor", text: "Mystery illness outbreak in rural Maharashtra. Death toll rising.", emotion: "news" },
                        { character: "Viren", text: "Arora Biotech is working round the clock for cure. Price will be reasonable.", emotion: "tv" },
                        { character: "Krishna", text: "He creates disease, then sells cure. Monster.", emotion: "disgusted" },
                        { character: "Sakshi", text: "More reason to stop him. No matter what.", emotion: "determined" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(6, 1)
                }
            }
        },

        6: {
            title: "The Serpent's Gate",
            location: "Temple Outer Chambers",
            scenes: {
                1: {
                    title: "Temple Approach - Dawn",
                    dialogues: [
                        { character: "Krishna", text: "अद्भुत (Incredible)! Our ancestors built this?", emotion: "awestruck" },
                        { character: "Sakshi", text: "Every stone carved with devotion. Every measurement perfect.", emotion: "emotional" },
                        { character: "Dr. Iyer", text: "Temple is closed to non-Hindus after 6 PM. Use my research permit.", emotion: "informing" },
                        { character: "Temple Guard", text: "Purpose of visit?", emotion: "stern" },
                        { character: "Dr. Iyer", text: "Architectural documentation for UNESCO.", emotion: "calm" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(6, 2)
                },
                2: {
                    title: "Outer Chamber Puzzles",
                    dialogues: [
                        { character: "Sakshi", text: "'Only those pure of heart and intention may proceed'... Bhai, it's not just translation. It's spiritual test.", emotion: "translating" },
                        { character: "Krishna", text: "सत्यम् शिवम् सुन्दरम् (Truth, Divinity, Beauty) - we need to wait for specific time.", emotion: "analyzing" },
                        { character: "Sakshi", text: "Ancient solar engineering! They knew exact angles!", emotion: "impressed" }
                    ],
                    puzzle: {
                        type: "solar_alignment",
                        title: "Sunlight Alignment Puzzle",
                        description: "Wait until sunlight forms Sanskrit letters to unlock mechanism"
                    },
                    action: () => this.startChapterScene(6, 3)
                },
                3: {
                    title: "The Music Chamber",
                    dialogues: [
                        { character: "Sakshi", text: "Om Namo Narayanaya... the melody opens the passage.", emotion: "humming" },
                        { character: "Krishna", text: "Our ancestors made security systems that are also art.", emotion: "awe" }
                    ],
                    puzzle: {
                        type: "musical_sequence",
                        title: "Vedic Chant Melody",
                        description: "Recreate musical notes matching Vedic chants to open door"
                    },
                    action: () => this.startChapterScene(6, 4)
                },
                4: {
                    title: "Captured!",
                    dialogues: [
                        { character: "Viren's Lieutenant", text: "Thank you for doing the hard work. We'll take it from here.", emotion: "smug" },
                        { character: "Krishna", text: "Let Sakshi go. This is between me and Viren.", emotion: "pleading" },
                        { character: "Lieutenant", text: "Both of you are valuable. Especially the little genius.", emotion: "threatening" },
                        { character: "Sakshi", text: "Don't give them anything, bhai! Remember our promise!", emotion: "brave" },
                        { character: "Krishna", text: "Sakshi! I'll find you!", emotion: "anguished" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(7, 1)
                }
            }
        },
        7: {
            title: "The Flooded Passages",
            location: "Temple Underground",
            scenes: {
                1: {
                    title: "Alone and Desperate",
                    dialogues: [
                        { character: "Krishna", text: "Sakshi... I failed to protect you. But I won't fail to save you.", emotion: "internal_monologue" }
                    ],
                    puzzle: {
                        type: "water_flow_timing",
                        title: "Control Water Levels",
                        description: "Time the water flow to access different tunnel levels"
                    },
                    action: () => this.startChapterScene(7, 2)
                },
                2: {
                    title: "Supernatural Guidance",
                    dialogues: [
                        { character: "Krishna", text: "These lights... divine guidance? या मेरा दिमाग खराब हो गया है (Or am I losing my mind)?", emotion: "confused" },
                        { character: "Serpent Guardian", text: "पुत्र, this path leads to destruction.", emotion: "mystical_voice" },
                        { character: "Krishna", text: "Naag devata, I seek only to save my sister and protect sacred knowledge.", emotion: "respectful" }
                    ],
                    puzzle: {
                        type: "light_pattern",
                        title: "Divine Light Puzzle",
                        description: "Follow the sequence of mysterious lights to avoid hidden traps"
                    },
                    action: () => this.startChapterScene(7, 3)
                },
                3: {
                    title: "Flashback - Sibling Bond",
                    dialogues: [
                        { character: "Young Sakshi", text: "Bhai, Sanskrit isn't just language. It's code of universe itself.", emotion: "teaching" },
                        { character: "Young Krishna", text: "Too complicated for me.", emotion: "confused" },
                        { character: "Young Sakshi", text: "I'll always be here to help you understand.", emotion: "supportive" },
                        { character: "Krishna", text: "I understand now, choti. Language, coding, spirituality—all connected. Just like us.", emotion: "smiling" }
                    ],
                    puzzle: {
                        type: "memory_sequence",
                        title: "Sibling Sanskrit Code",
                        description: "Recall the correct sequence of Sanskrit syllables from childhood lessons"
                    },
                    action: () => this.startChapterScene(7, 4)
                },
                4: {
                    title: "The Temple's Heart",
                    dialogues: [
                        { character: "Krishna", text: "Vishnu bhagwan, grant me strength. Not for myself, but for dharma.", emotion: "praying" },
                        { character: "Krishna", text: "Divine intervention... or perfect engineering? Maybe both.", emotion: "awed" }
                    ],
                    puzzle: {
                        type: "water_level_control",
                        title: "Reveal Hidden Passage",
                        description: "Manually adjust valves to lower water and access Vault B"
                    },
                    action: () => this.startChapterScene(8, 1)
                }
            }
        },

        8: {
            title: "The Vault's Secret",
            location: "Vault B Approach",
            scenes: {
                1: {
                    title: "Viren's Torture Chamber",
                    dialogues: [
                        { character: "Viren Arora", text: "Miss Patil, you're remarkably stubborn for someone so small.", emotion: "cruel" },
                        { character: "Sakshi", text: "Size doesn't determine courage. My brother taught me that.", emotion: "fierce" },
                        { character: "Viren", text: "Your brother is probably dead in those flooded tunnels.", emotion: "mocking" },
                        { character: "Sakshi", text: "Krishna never gives up. Neither do I.", emotion: "confident" }
                    ],
                    puzzle: {
                        type: "escape_sequence",
                        title: "Deceive Captors",
                        description: "Arrange false Sanskrit translations to stall Viren's team"
                    },
                    action: () => this.startChapterScene(8, 2)
                },
                2: {
                    title: "False Translations",
                    dialogues: [
                        { character: "Viren's Expert", text: "The algorithm should unlock Vault B.", emotion: "expectant" },
                        { character: "Sakshi", text: "Sanskrit says 'चन्द्र प्रकाश में खुलेगा' (Opens in moonlight). You need to wait for night.", emotion: "lying" },
                        { character: "Viren", text: "You're stalling.", emotion: "suspicious" },
                        { character: "Sakshi", text: "Ancient knowledge can't be rushed. Force it, and it destroys itself.", emotion: "warning" }
                    ],
                    puzzle: {
                        type: "code_deception",
                        title: "Craft False Algorithm",
                        description: "Create a misleading code to confuse attackers"
                    },
                    action: () => this.startChapterScene(8, 3)
                },
                3: {
                    title: "Krishna's Discovery",
                    dialogues: [
                        { character: "Krishna", text: "'भाई, वॉल्ट बी में जाल है' (Brother, Vault B is trapped). She's warning me.", emotion: "reading" },
                        { character: "Krishna", text: "Even in captivity, she's protecting the mission. My brave little sister.", emotion: "emotional" }
                    ],
                    puzzle: {
                        type: "hidden_message",
                        title: "Decode Warning",
                        description: "Use Sanskrit wordplay to uncover Sakshi's secret warning"
                    },
                    action: () => this.startChapterScene(8, 4)
                },
                4: {
                    title: "The True Conspiracy Revealed",
                    dialogues: [
                        { character: "Krishna", text: "Corona virus... engineered. Millions died for his profit. Monster!", emotion: "horrified" },
                        { character: "Krishna", text: "He's been erasing humanity's healing wisdom to maintain monopoly. Not anymore.", emotion: "determined" }
                    ],
                    puzzle: {
                        type: "research_puzzle",
                        title: "Expose Conspiracy",
                        description: "Piece together documents to reveal Viren's plan"
                    },
                    action: () => this.startChapterScene(9, 1)
                }
            }
        },

        9: {
            title: "The Watch Signal",
            location: "Final Preparations",
            scenes: {
                1: {
                    title: "The Broken Watch",
                    dialogues: [
                        { character: "Krishna", text: "Watch is dead... but if signal went through...", emotion: "noticing" }
                    ],
                    puzzle: {
                        type: "emergency_signal",
                        title: "Send Distress Signal",
                        description: "Repair watch circuits to send emergency signal"
                    },
                    action: () => this.startChapterScene(9, 2)
                },
                2: {
                    title: "Laxman's Journey",
                    dialogues: [
                        { character: "Laxman", text: "Run Sole Mate for few days. I have to save my brother.", emotion: "determined" },
                        { character: "Employee", text: "Sir, Kerala is far. Should we inform police?", emotion: "concerned" },
                        { character: "Laxman", text: "Police won't understand. This needs street-smart solution.", emotion: "decisive" }
                    ],
                    puzzle: {
                        type: "navigation_puzzle",
                        title: "Plan Route",
                        description: "Plot the fastest way through South India's transport network"
                    },
                    action: () => this.startChapterScene(9, 3)
                },
                3: {
                    title: "Unexpected Arrival",
                    dialogues: [
                        { character: "Laxman", text: "So this is your idea of vacation? Five-star temple with complimentary drowning?", emotion: "casual" },
                        { character: "Krishna", text: "Laxman! How did you—", emotion: "overjoyed" },
                        { character: "Laxman", text: "Emergency watch, genius. Also brought better shoes—yours are terrible for climbing.", emotion: "teasing" },
                        { character: "Krishna", text: "Sakshi's captured. I need help.", emotion: "urgent" },
                        { character: "Laxman", text: "Then let's go get our girl back.", emotion: "serious" }
                    ],
                    puzzle: {
                        type: "equipment_puzzle",
                        title: "Prepare Gear",
                        description: "Select the right equipment from pack for temple rescue"
                    },
                    action: () => this.startChapterScene(9, 4)
                },
                4: {
                    title: "Planning the Rescue",
                    dialogues: [
                        { character: "Krishna", text: "Viren has high-tech security, trained mercenaries.", emotion: "worried" },
                        { character: "Laxman", text: "And we have street smarts, divine protection, and righteous anger. Sometimes that's enough.", emotion: "confident" },
                        { character: "Krishna", text: "This isn't game, yaar. People could die.", emotion: "serious" },
                        { character: "Laxman", text: "People are already dying from his engineered diseases. Time to stop talking, start acting.", emotion: "motivational" }
                    ],
                    puzzle: {
                        type: "strategy_planning",
                        title: "Map the Rescue",
                        description: "Plan the infiltration route to avoid high security zones"
                    },
                    action: () => this.startChapterScene(10, 1)
                }
            }
        },

        10: {
            title: "The Sutra's Guardian",
            location: "Vault B Interior",
            scenes: {
                1: {
                    title: "Infiltration",
                    dialogues: [
                        { character: "Laxman", text: "For a temple, this place has way too many computers.", emotion: "whispering" },
                        { character: "Krishna", text: "He's turned sacred space into laboratory. Sacrilege.", emotion: "disgusted" },
                        { character: "Viren", text: "If the girl won't cooperate, kill her. We'll extract the knowledge by force.", emotion: "threatening" },
                        { character: "Krishna", text: "Over my dead body.", emotion: "enraged" }
                    ],
                    puzzle: {
                        type: "stealth_puzzle",
                        title: "Avoid Detection",
                        description: "Navigate through the lab avoiding guards and cameras"
                    },
                    action: () => this.startChapterScene(10, 2)
                },
                2: {
                    title: "Vault B Revealed",
                    dialogues: [
                        { character: "Krishna", text: "This isn't vault. It's ancient medical research center!", emotion: "amazed" },
                        { character: "Laxman", text: "Our ancestors were doing experiments here?", emotion: "surprised" },
                        { character: "Krishna", text: "They weren't just spiritual—they were scientists! This knowledge could cure everything!", emotion: "excited" }
                    ],
                    puzzle: {
                        type: "research_puzzle",
                        title: "Analyze Artifacts",
                        description: "Match ancient tools with their modern scientific equivalents"
                    },
                    action: () => this.startChapterScene(10, 3)
                },
                3: {
                    title: "The Guardian Test",
                    dialogues: [
                        { character: "Sakshi", text: "Bhai! I knew you'd come!", emotion: "reunited" },
                        { character: "Krishna", text: "Never doubt your brother. We finish this together.", emotion: "comforting" },
                        { character: "Laxman", text: "Family reunion later. How do we solve this thing?", emotion: "practical" },
                        { character: "Sakshi", text: "The Sutra isn't just medical text—it's comprehensive healing system. Physical, mental, spiritual.", emotion: "explaining" }
                    ],
                    puzzle: {
                        type: "collaborative_puzzle",
                        title: "Guardian Test",
                        description: "Coordinate quantum algorithms, astronomical calculations, and engineering"
                    },
                    action: () => this.startChapterScene(10, 4)
                },
                4: {
                    title: "Viren's Last Stand",
                    dialogues: [
                        { character: "Viren", text: "Touching family reunion. Now hand over the Sutra, or everyone dies.", emotion: "threatening" },
                        { character: "Krishna", text: "Knowledge belongs to humanity!", emotion: "defiant" },
                        { character: "Viren", text: "Humanity can't handle this power. I can.", emotion: "arrogant" },
                        { character: "Sakshi", text: "You're not God!", emotion: "defiant" },
                        { character: "Viren", text: "In the medical world, I am.", emotion: "domineering" }
                    ],
                    puzzle: {
                        type: "final_confrontation",
                        title: "Battle of Wits",
                        description: "Outsmart Viren via quick strategic decisions"
                    },
                    action: () => this.startChapterScene(11, 1)
                }
            }
        },

        11: {
            title: "The Cliff's Edge",
            location: "Final Confrontation",
            scenes: {
                1: {
                    title: "Tower Battle",
                    dialogues: [
                        { character: "Krishna", text: "This temple has stood for centuries! Your greed ends here!", emotion: "fighting" },
                        { character: "Viren", text: "Ancient wisdom is wasted on the masses! Only the elite deserve immortality!", emotion: "sneering" },
                        { character: "Sakshi", text: "Bhai, remember—our ancestors built escape routes!", emotion: "tactical" }
                    ],
                    puzzle: {
                        type: "combat_strategy",
                        title: "Tower Battle",
                        description: "Use the environment and combat skills to overcome enemies"
                    },
                    action: () => this.startChapterScene(11, 2)
                },
                2: {
                    title: "Laxman's Heroic Moment",
                    dialogues: [
                        { character: "Laxman", text: "Sorry, but this doesn't belong to you!", emotion: "defiant" },
                        { character: "Viren", text: "You street-smart fool! You don't understand its value!", emotion: "furious" },
                        { character: "Laxman", text: "I understand its value better than you. It's priceless because it's meant to be free.", emotion: "confident" }
                    ],
                    puzzle: {
                        type: "artifact_heist",
                        title: "Steal the Sutra",
                        description: "Distract guards and retrieve the artifact"
                    },
                    action: () => this.startChapterScene(11, 3)
                },
                3: {
                    title: "Sakshi's Strength",
                    dialogues: [
                        { character: "Viren", text: "One more step and the girl dies!", emotion: "threatening" },
                        { character: "Sakshi", text: "Bhai, remember what you taught me about leverage?", emotion: "calm" },
                        { character: "Sakshi", text: "Small doesn't mean weak. It means underestimated.", emotion: "defiant" }
                    ],
                    puzzle: {
                        type: "escape_puzzle",
                        title: "Sakshi's Escape",
                        description: "Use environment clues and size advantage to escape"
                    },
                    action: () => this.startChapterScene(11, 4)
                },
                4: {
                    title: "Divine Justice",
                    dialogues: [
                        { character: "Viren", text: "If I can't have it, no one can!", emotion: "falling" },
                        { character: "Krishna", text: "Greed has its own gravity. It pulls you down.", emotion: "resolute" }
                    ],
                    puzzle: {
                        type: "final_choice",
                        title: "Save or Let Fall",
                        description: "Choose whether to save Viren or let him fall, affecting the story end"
                    },
                    action: () => this.startChapterScene(12, 1)
                }
            }
        },

        12: {
            title: "The Return",
            location: "Resolution and Future",
            scenes: {
                1: {
                    title: "Aftermath",
                    dialogues: [
                        { character: "Krishna", text: "Parth ji's sacrifice wasn't in vain. The knowledge is safe.", emotion: "peaceful" },
                        { character: "Sakshi", text: "And it'll be shared freely, like he wanted.", emotion: "content" },
                        { character: "Laxman", text: "So, back to normal life now? Because I have shoes to sell.", emotion: "lighthearted" },
                        { character: "All", text: "(*All laugh*)", emotion: "happy" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(12, 2)
                },
                2: {
                    title: "The Vedic Sutra",
                    dialogues: [
                        { character: "Dr. Iyer", text: "This knowledge... it's not just medicine. It's complete healing—body, mind, soul.", emotion: "warm" },
                        { character: "Sakshi", text: "We'll work with ethical scientists. Open source everything.", emotion: "dedicated" },
                        { character: "Krishna", text: "No patents, no monopolies. Just healing.", emotion: "determined" }
                    ],
                    puzzle: {
                        type: "ethics_decision",
                        title: "Set Research Policy",
                        description: "Decide how to share the Vedic Sutra knowledge with the world"
                    },
                    action: () => this.startChapterScene(12, 3)
                },
                3: {
                    title: "Mumbai Return",
                    dialogues: [
                        { character: "Sakshi", text: "Bhai, I'm not your little sister anymore. I'm your equal partner.", emotion: "proud" },
                        { character: "Krishna", text: "You always were. I just needed to see it.", emotion: "smiling" },
                        { character: "Sakshi", text: "And you're not just my brilliant brother. You're my hero.", emotion: "emotional" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(12, 4)
                },
                4: {
                    title: "New Beginning",
                    dialogues: [
                        { character: "Krishna", text: "Technology should serve humanity, not control it. Our new mission: making healing accessible to everyone.", emotion: "press" },
                        { character: "Sakshi", text: "Ancient wisdom, modern application, human compassion.", emotion: "confident" },
                        { character: "Reporter", text: "What's next for you two?", emotion: "curious" },
                        { characters: ["Krishna", "Sakshi"], text: "Whatever the world needs.", emotion: "together" }
                    ],
                    puzzle: null,
                    action: () => this.startChapterScene(12, 5)
                },
                5: {
                    title: "Spiritual Conclusion",
                    dialogues: [
                        { character: "Laxman", text: "Still think that shadow in Kerala was just wind?", emotion: "teasing" },
                        { character: "Krishna", text: "Hanuman ji protected us throughout. Divine intervention isn't superstition—it's reality for those with faith.", emotion: "praying" },
                        { character: "Sakshi", text: "Bhai taught me coding. God taught us purpose.", emotion: "reflective" },
                        { character: "Krishna", text: "True treasure isn't gold or technology. It's knowledge shared with love, wisdom applied with compassion, and bonds that transcend everything else.", emotion: "voice_over" }
                    ],
                    puzzle: {
                        type: "final_reflection",
                        title: "Meditation",
                        description: "Reflect on the journey and commit to the path ahead"
                    },
                    action: () => this.endGame()
                }
            }
        }
            //game over
        };
    }

    startChapterScene(chapterNumber, sceneNumber) {
        const chapterData = this.chapterData[chapterNumber];
        const sceneData = chapterData.scenes[sceneNumber];
        
        if (!sceneData) {
            this.completeChapter(chapterNumber);
            return;
        }
        
        this.currentScene = sceneNumber;
        this.currentDialogues = sceneData.dialogues || [];
        this.currentDialogue = 0;
        this.gameState = 'dialogue';
        
        document.getElementById('progress-text').textContent = sceneData.title;
        
        if (this.currentDialogues.length > 0) {
            this.showDialogue(this.currentDialogues[0]);
        } else if (sceneData.puzzle) {
            this.showPuzzle(sceneData.puzzle);
        } else {
            sceneData.action();
        }
    }

    showDialogue(dialogue) {
        const dialogueBox = document.getElementById('dialogue-box');
        const characterName = document.getElementById('character-name');
        const dialogueText = document.getElementById('dialogue-text');
        
        characterName.textContent = dialogue.character;
        dialogueText.textContent = dialogue.text;
        
        // Apply emotion styling
        dialogueBox.className = `dialogue-box active emotion-${dialogue.emotion || 'neutral'}`;
        
        this.gameState = 'dialogue';
    }

    nextDialogue() {
        if (this.currentDialogue < this.currentDialogues.length - 1) {
            this.currentDialogue++;
            this.showDialogue(this.currentDialogues[this.currentDialogue]);
        } else {
            // Dialogue finished
            document.getElementById('dialogue-box').classList.remove('active');
            
            const chapterData = this.chapterData[this.currentChapter];
            const sceneData = chapterData.scenes[this.currentScene];
            
            if (sceneData.puzzle) {
                this.showPuzzle(sceneData.puzzle);
            } else {
                sceneData.action();
            }
        }
    }

    showPuzzle(puzzleData) {
        const puzzleContainer = document.getElementById('puzzle-container');
        const puzzleTitle = document.getElementById('puzzle-title');
        const puzzleDescription = document.getElementById('puzzle-description');
        const puzzleGrid = document.getElementById('puzzle-grid');
        
        puzzleTitle.textContent = puzzleData.title;
        puzzleDescription.textContent = puzzleData.description;
        
        // Generate puzzle based on type
        this.puzzleSystem.generatePuzzle(puzzleData.type, puzzleData.items, puzzleGrid);
        
        puzzleContainer.classList.add('active');
        this.gameState = 'puzzle';
    }

    initThreeJS() {
        const container = document.getElementById('game-container');
        
        // Clear previous renderer
        if (this.renderer) {
            container.removeChild(this.renderer.domElement);
        }
        
        // Scene
        this.scene = new THREE.Scene();
        this.scene.background = new THREE.Color(0x0a0a15);

        // Camera
        this.camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
        this.camera.position.set(0, 2, 5);

        // Renderer
        this.renderer = new THREE.WebGLRenderer({ antialias: true });
        this.renderer.setSize(container.clientWidth, container.clientHeight);
        this.renderer.shadowMap.enabled = true;
        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(this.renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
        this.scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(10, 10, 5);
        directionalLight.castShadow = true;
        this.scene.add(directionalLight);

        // Create environment based on chapter
        this.createChapterEnvironment(this.currentChapter);

        // Start render loop
        this.animate();

        // Handle window resize
        window.addEventListener('resize', () => this.onWindowResize());
    }

    createChapterEnvironment(chapterNumber) {
        // Ground
        const groundGeometry = new THREE.PlaneGeometry(100, 100);
        const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x2a2a3a });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        this.scene.add(ground);

        // Chapter-specific environments
        switch (chapterNumber) {
            case 1:
                this.createMumbaiOffice();
                break;
            case 2:
                this.createLaboratory();
                break;
            default:
                this.createDefaultEnvironment();
        }
    }

    createMumbaiOffice() {
        // Conference table
        const tableGeometry = new THREE.BoxGeometry(4, 0.1, 2);
        const tableMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
        const table = new THREE.Mesh(tableGeometry, tableMaterial);
        table.position.y = 0.8;
        table.castShadow = true;
        this.scene.add(table);

        // Chairs
        for (let i = 0; i < 6; i++) {
            const chairGeometry = new THREE.BoxGeometry(0.4, 0.8, 0.4);
            const chairMaterial = new THREE.MeshLambertMaterial({ color: 0x654321 });
            const chair = new THREE.Mesh(chairGeometry, chairMaterial);
            chair.position.set((i % 3) * 1.5 - 1.5, 0.4, i < 3 ? -1.5 : 1.5);
            chair.castShadow = true;
            this.scene.add(chair);
        }

        // Presentation screen
        const screenGeometry = new THREE.PlaneGeometry(3, 2);
        const screenMaterial = new THREE.MeshLambertMaterial({ 
            color: 0x000040,
            emissive: 0x000020
        });
        const screen = new THREE.Mesh(screenGeometry, screenMaterial);
        screen.position.set(0, 2, -4);
        this.scene.add(screen);
    }

    createLaboratory() {
        // Lab equipment
        for (let i = 0; i < 5; i++) {
            const equipGeometry = new THREE.BoxGeometry(0.8, 1.5, 0.6);
            const equipMaterial = new THREE.MeshLambertMaterial({ color: 0x4a4a4a });
            const equipment = new THREE.Mesh(equipGeometry, equipMaterial);
            equipment.position.set(i * 2 - 4, 0.75, -2);
            equipment.castShadow = true;
            this.scene.add(equipment);
        }

        // Computer screens
        for (let i = 0; i < 3; i++) {
            const screenGeometry = new THREE.PlaneGeometry(0.6, 0.4);
            const screenMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x004400,
                emissive: 0x002200
            });
            const screen = new THREE.Mesh(screenGeometry, screenMaterial);
            screen.position.set(i * 2 - 2, 1.2, 1.5);
            this.scene.add(screen);
        }
    }

    createDefaultEnvironment() {
        // Simple default objects
        const cubeGeometry = new THREE.BoxGeometry(1, 1, 1);
        const cubeMaterial = new THREE.MeshLambertMaterial({ color: 0x6e44ff });
        const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
        cube.position.y = 0.5;
        cube.castShadow = true;
        this.scene.add(cube);
    }

    animate() {
        if (this.gameState === 'playing' || this.gameState === 'dialogue' || this.gameState === 'puzzle') {
            requestAnimationFrame(() => this.animate());
            this.renderer.render(this.scene, this.camera);
        }
    }

    onWindowResize() {
        const container = document.getElementById('game-container');
        this.camera.aspect = container.clientWidth / container.clientHeight;
        this.camera.updateProjectionMatrix();
        this.renderer.setSize(container.clientWidth, container.clientHeight);
    }

    completeChapter(chapterNumber) {
        this.playerData.progress[chapterNumber] = true;
        this.savePlayerData();
        
        if (chapterNumber < 12) {
            const nextChapter = chapterNumber + 1;
            setTimeout(() => {
                if (confirm(`Chapter ${chapterNumber} Complete!\n\nProceed to Chapter ${nextChapter}?`)) {
                    this.startChapter(nextChapter);
                } else {
                    this.showMainMenu();
                }
            }, 2000);
        } else {
            this.showGameComplete();
        }
    }

    showGameComplete() {
        alert('Congratulations! You have completed The Padmanabha Enigma!\n\nसत्यम् शिवम् सुन्दरम्\n\nThank you for your journey through ancient wisdom and modern technology.');
        this.showMainMenu();
    }

    updateProgress() {
        const progressFill = document.getElementById('progress-fill');
        const progress = (Object.keys(this.playerData.progress).length / 12) * 100;
        progressFill.style.width = `${progress}%`;
    }

    interact() {
        console.log('Interaction triggered');
    }

    toggleInventory() {
        const inventoryPanel = document.getElementById('inventory-panel');
        if (inventoryPanel.classList.contains('active')) {
            inventoryPanel.classList.remove('active');
        } else {
            inventoryPanel.classList.add('active');
            this.inventorySystem.render();
        }
    }

    showPauseMenu() {
        if (confirm('Game Paused. Return to main menu?')) {
            this.returnToMainMenu();
        }
    }

    returnToMainMenu() {
        document.getElementById('game-interface').classList.remove('active');
        document.getElementById('main-menu').classList.add('active');
        this.gameState = 'menu';
        
        if (this.renderer) {
            document.getElementById('game-container').removeChild(this.renderer.domElement);
            this.renderer = null;
        }
    }

    savePlayerData() {
        localStorage.setItem('eternitytech_progress', JSON.stringify(this.playerData.progress));
        localStorage.setItem('eternitytech_inventory', JSON.stringify(this.playerData.inventory));
        localStorage.setItem('eternitytech_settings', JSON.stringify(this.playerData.settings));
    }
}

// Puzzle System
class PuzzleSystem {
    generatePuzzle(type, items, container) {
        container.innerHTML = '';
        
        switch (type) {
            case 'sanskrit_sequence':
                this.generateSequencePuzzle(items, container);
                break;
            case 'escape_route':
                this.generatePathPuzzle(items, container);
                break;
            case 'cipher_decode':
                this.generateCipherPuzzle(items, container);
                break;
            case 'medical_formula':
                this.generateFormulaPuzzle(items, container);
                break;
            default:
                this.generateDefaultPuzzle(items, container);
        }
    }

    generateSequencePuzzle(items, container) {
        container.style.gridTemplateColumns = `repeat(${Math.ceil(items.length / 2)}, 1fr)`;
        
        // Shuffle items
        const shuffledItems = [...items].sort(() => Math.random() - 0.5);
        
        shuffledItems.forEach((item, index) => {
            const puzzleItem = document.createElement('div');
            puzzleItem.className = 'puzzle-item';
            puzzleItem.textContent = item;
            puzzleItem.dataset.index = index;
            puzzleItem.dataset.correct = items.indexOf(item);
            
            puzzleItem.addEventListener('click', () => {
                document.querySelectorAll('.puzzle-item').forEach(el => el.classList.remove('selected'));
                puzzleItem.classList.add('selected');
            });
            
            container.appendChild(puzzleItem);
        });
    }

    generatePathPuzzle(items, container) {
        container.style.gridTemplateColumns = 'repeat(3, 1fr)';
        
        items.forEach((item, index) => {
            const puzzleItem = document.createElement('div');
            puzzleItem.className = 'puzzle-item';
            puzzleItem.textContent = item;
            puzzleItem.dataset.index = index;
            
            puzzleItem.addEventListener('click', () => {
                if (item === 'Temple' || item === 'Prayer Hall') {
                    puzzleItem.classList.add('correct');
                    setTimeout(() => {
                        this.solvePuzzle();
                    }, 1000);
                } else {
                    puzzleItem.style.backgroundColor = '#ff4466';
                    setTimeout(() => {
                        puzzleItem.style.backgroundColor = '';
                    }, 1000);
                }
            });
            
            container.appendChild(puzzleItem);
        });
    }

    generateCipherPuzzle(items, container) {
        container.style.gridTemplateColumns = 'repeat(3, 1fr)';
        
        items.forEach((item, index) => {
            const puzzleItem = document.createElement('div');
            puzzleItem.className = 'puzzle-item';
            puzzleItem.innerHTML = `<span class="sanskrit">${item}</span>`;
            puzzleItem.dataset.index = index;
            
            puzzleItem.addEventListener('click', () => {
                puzzleItem.classList.toggle('selected');
            });
            
            container.appendChild(puzzleItem);
        });
    }

    generateFormulaPuzzle(items, container) {
        container.style.gridTemplateColumns = 'repeat(2, 1fr)';
        
        items.forEach((item, index) => {
            const puzzleItem = document.createElement('div');
            puzzleItem.className = 'puzzle-item';
            puzzleItem.innerHTML = `<span class="sanskrit">${item}</span>`;
            puzzleItem.dataset.index = index;
            puzzleItem.dataset.order = index;
            
            puzzleItem.addEventListener('click', () => {
                document.querySelectorAll('.puzzle-item').forEach(el => el.classList.remove('selected'));
                puzzleItem.classList.add('selected');
            });
            
            container.appendChild(puzzleItem);
        });
    }

    generateDefaultPuzzle(items, container) {
        container.style.gridTemplateColumns = 'repeat(2, 1fr)';
        
        items.forEach((item, index) => {
            const puzzleItem = document.createElement('div');
            puzzleItem.className = 'puzzle-item';
            puzzleItem.textContent = item;
            puzzleItem.dataset.index = index;
            
            container.appendChild(puzzleItem);
        });
    }

    solvePuzzle() {
        document.getElementById('puzzle-container').classList.remove('active');
        
        const chapterData = window.game.chapterData[window.game.currentChapter];
        const sceneData = chapterData.scenes[window.game.currentScene];
        sceneData.action();
    }
}

// Inventory System
class InventorySystem {
    constructor() {
        this.items = [];
        this.maxSlots = 16;
    }

    render() {
        const inventoryGrid = document.getElementById('inventory-grid');
        inventoryGrid.innerHTML = '';

        for (let i = 0; i < this.maxSlots; i++) {
            const slot = document.createElement('div');
            slot.className = 'inventory-slot';
            
            if (this.items[i]) {
                slot.classList.add('occupied');
                slot.innerHTML = `<i class="fas fa-${this.items[i].icon}"></i>`;
                slot.title = this.items[i].name;
            }

            inventoryGrid.appendChild(slot);
        }
    }

    addItem(item) {
        if (this.items.length < this.maxSlots) {
            this.items.push(item);
            return true;
        }
        return false;
    }
}

// Global Functions
function skipBackstory() {
    document.getElementById('backstory-screen').classList.remove('active');
    window.game.showMainMenu();
}

function startNewGame() {
    window.game.startNewGame();
}

function continueGame() {
    window.game.continueGame();
}

function showChapterSelect() {
    alert('Chapter selection coming soon! For now, start a new game to play through all chapters.');
}

function showSettings() {
    alert('Settings menu coming soon!');
}

function showCredits() {
    alert('Eternity Tech: The Padmanabha Enigma\n\nA game combining ancient Sanskrit wisdom with modern quantum computing.\n\nInspired by the rich cultural heritage of India and the unlimited potential of technology.\n\nसत्यम् शिवम् सुन्दरम्');
}

function checkPuzzle() {
    const selectedItems = document.querySelectorAll('.puzzle-item.selected');
    if (selectedItems.length > 0) {
        window.game.puzzleSystem.solvePuzzle();
    } else {
        alert('Please select items to solve the puzzle!');
    }
}

function resetPuzzle() {
    document.querySelectorAll('.puzzle-item').forEach(item => {
        item.classList.remove('selected', 'correct');
        item.style.backgroundColor = '';
    });
}

function closePuzzle() {
    document.getElementById('puzzle-container').classList.remove('active');
    window.game.gameState = 'playing';
}

function closeInventory() {
    document.getElementById('inventory-panel').classList.remove('active');
}

// Initialize the game when the page loads
window.addEventListener('load', () => {
    window.game = new EternityTechGame();
});
</script>
</body>
</html>